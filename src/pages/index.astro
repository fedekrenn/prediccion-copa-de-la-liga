---
import Layout from "../layouts/Layout.astro";
import main from "../utils/main";

let results = await main();
---

<Layout title="Welcome to Astro.">
  <main>
    <h1>Predicción de tabla final</h1>
    <section class="legend">
      <p>
        Esta tabla es una predicción de como finalizarían las posiciones tomando
        en cuenta el desempeño actual de cada equipo en la copa de la liga.
      </p>
      <p>
        Se calcula el % de puntos obtenido contando solo esta copa, en base a
        eso se estima cuantos puntos obtendrá para luego sumar dichos puntos a
        los obtenidos en la temporada regular del primer semestre. El resultado
        es un estimativo para copas + descensos.
      </p>
      <p>
        Al ser una predicción en base al % de puntos obtenidos, nada garantiza
        que efectivamente terminen como la tabla a continuación indica.
      </p>
      <p class="alert">
        <strong>IMPORTANTE:</strong>
        La tabla es dinámica y está conectada a una fuente de información que se
        actualiza automáticamente. Por lo que los datos que se muestran son siempre
        los más recientes, incluso si los equipos están jugando en este momento.
      </p>
      <p>
        Coloca el mouse sobre la fila del equipo para ver los puntos actuales.
      </p>
    </section>
    <section>
      <div class="colors-container">
        <div>
          <p>Copa Libertadores</p>
          <div class="square green"></div>
        </div>
        <div>
          <p>Copa Sudamericana</p>
          <div class="square yellow"></div>
        </div>
        <div>
          <p>Desciende por tabla</p>
          <div class="square red"></div>
        </div>
        <div>
          <p>Descendió por promedios</p>
          <div class="square dark-red"></div>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>Posición</th>
            <th class="team-name">Equipo</th>
            <th>% en copa de la liga</th>
            <th class="points">Puntos estimados al finalizar el campeonato</th>
          </tr>
        </thead>
        <tbody>
          {
            results?.map(
              ({
                nombre,
                puntosTotales,
                posicion,
                porcentajeActual,
                puntosFinalesEstimados,
              }) => (
                <tr title={`Puntos actuales de ${nombre}: ${puntosTotales}`}>
                  <td class="position">{posicion}</td>
                  <td>{nombre}</td>
                  <td>{porcentajeActual}</td>
                  <td>{puntosFinalesEstimados}</td>
                </tr>
              )
            )
          }
        </tbody>
      </table>
    </section>
  </main>
</Layout>

<style>
  h1 {
    text-align: center;
    margin: 50px;
  }

  .legend {
    text-align: center;
    margin: 50px;
  }

  .legend p {
    margin: 10px 0;
  }

  .colors-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin: 20px 0;
    font-size: 0.6em;
  }

  .colors-container div {
    text-align: center;
  }

  .colors-container div p {
    margin: 0 auto 5px auto;
    width: 80%;
  }

  .alert {
    color: orange;
  }

  .square {
    display: inline-block;
    width: 10px;
    height: 10px;
  }

  .green {
    background-color: rgb(0, 128, 0);
  }

  .yellow {
    background-color: rgb(160, 180, 42);
  }

  .red {
    background-color: rgb(243, 41, 41);
  }

  .dark-red {
    background-color: rgb(58, 8, 8);
  }

  table {
    margin: 0 auto;
    width: auto;
  }

  table .team-name {
    width: 220px;
  }

  table .points {
    width: 200px;
  }

  table th,
  table td {
    text-align: center;
  }

  tbody tr:hover {
    cursor: pointer;
  }

  tbody tr:nth-child(-n + 5) td.position {
    background-color: rgb(0, 128, 0);
  }

  tbody tr:nth-child(n + 6):nth-child(-n + 10) td.position {
    background-color: rgb(160, 180, 42);
    color: black;
  }

  tbody tr:last-child td.position {
    background-color: rgb(58, 8, 8);
  }

  tbody tr:nth-last-child(2) td.position {
    background-color: rgb(243, 41, 41);
  }
</style>
